# スキャン
## 1.概　要
- 攻撃者はスキャンするIPアドレスの範囲を特定すると、スキャンツールを選択することができる
- スキャンツールの代表格`nmap`は、高性能で強力なスキャンツールだが、大量のIPアドレスに対するスキャンには適していない
- 大量のIPアドレスに対するスキャンに優れたスキャンツールに`masscan`がある。
- masscanは、nmapのような評価機能は備えていないが、高速なスキャンができるツールである
  - 送信機能と受信機能を切り離すことで高速なより高いパフォーマンスを実現した
  - 1秒当たり約50000パケットぐらいスキャン可能（オプションにより指定可能） 

## 2.masscan
### スキャン対象の指定

- **IPアドレスまたは範囲**
```bash
masscan <ipアドレス/range>
```

- **IPアドレスリストから読み込み**
```bash
masscan -iL <ipアドレスリスト>
```

### ポート指定

- **単一ポート**
```bash
masscan -p <ポート番号>
```

- **複数ポート**
```bash
masscan -p <ポート1>,<ポート2>
```

- **ポート範囲**
```bash
masscan -p <開始ポート>-<終了ポート>
```

### スキャン速度
- **デフォルトは100パケット/秒。速度の指定は`--rate`オプションを使用**
```bash
masscan --rate=<速度>

# 例
masscan 192.168.1.0/24 -p 80 --rate=10000
```

### 出力オプション
- **XML形式**
```bash
masscan -oX <ファイル名>
```

- **JSON形式**
```bash
masscan -oJ <ファイル名>
```

- **Grep形式**
```bash
masscan -oG <ファイル名>
```

- **バイナリ形式**
```bash
masscan -oB <ファイル名>
```

- **通常形式**
```bash
masscan -oL <ファイル名>
```

### 高度なオプション

- **特定のIP範囲を除外** 
```bash
masscan --exclude <範囲>
```

- **ファイルから除外アドレスを読み込む**
```bash
masscan --ecludefile <ファイル名>
```

- **リトライ回数の指定**
```bash
masscan --retries <回数>
```

- **サービスのバナー情報の取得**
```bash
masscan --banners
```

### 実用例

- **高速全ポートスキャンし、出力結果をgrep形式で保存**
```bash
masscan 192.168.1.0/24 -p0-65535 -rate=1000000 -oG output.greppable 
```

- **特定サービスのバナー情報の取得**
```bash
masscan 192.168.1.0/24 -p80 --banners 
```

- **除外リストからアドレスを除外**
```bash
masscan 192.168.1.0/24 --excludefile exclude.txt 
```
